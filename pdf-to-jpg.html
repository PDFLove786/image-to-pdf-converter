<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to JPG Converter - Convert PDF Pages to Images</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #333; min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        h1 { color: #667eea; text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        .upload-area { border: 3px dashed #667eea; border-radius: 10px; padding: 40px; text-align: center; cursor: pointer; margin: 20px 0; transition: all 0.3s; }
        .upload-area:hover { background: #f0f4ff; }
        .btn { background: linear-gradient(to right, #667eea, #764ba2); color: white; border: none; padding: 12px 25px; border-radius: 50px; cursor: pointer; margin: 10px; font-weight: 600; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102,126,234,0.4); }
        .btn:disabled { background: #cccccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-secondary { background: #6c757d; }
        .page-preview { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .page-thumbnails { display: flex; flex-wrap: wrap; gap: 15px; margin: 15px 0; justify-content: center; }
        .page-thumb { width: 120px; height: 170px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .page-thumb.selected { border-color: #667eea; box-shadow: 0 0 15px rgba(102,126,234,0.5); }
        .page-number { position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.8); color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .page-checkbox { position: absolute; top: 5px; left: 5px; width: 20px; height: 20px; }
        .back-btn { display: inline-block; background: #667eea; color: white; padding: 12px 25px; border-radius: 50px; text-decoration: none; margin-top: 20px; font-weight: 600; }
        .quality-options { background: #e3f2fd; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; }
        .loading { text-align: center; padding: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .progress-bar { width: 100%; height: 10px; background: #f0f0f0; border-radius: 5px; margin: 15px 0; overflow: hidden; }
        .progress { height: 100%; background: linear-gradient(to right, #667eea, #764ba2); border-radius: 5px; transition: width 0.3s; width: 0%; }
        .format-options { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .format-option { display: flex; align-items: center; gap: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÑ‚Üíüñº PDF to JPG Converter</h1>
        <p class="subtitle">Convert PDF pages to high-quality JPG images</p>
        
        <!-- Upload Area -->
        <div class="upload-area" id="dropArea">
            <div style="font-size: 50px; margin-bottom: 15px;">üìÇ</div>
            <h3>Select PDF File to Convert</h3>
            <p>Drag & drop your PDF file here or click to browse</p>
            <button class="btn" onclick="document.getElementById('fileInput').click()" style="margin-top: 15px;">
                Choose PDF File
            </button>
            <input type="file" id="fileInput" accept=".pdf" style="display: none;">
        </div>

        <!-- Quality Options -->
        <div class="quality-options" id="qualityOptions" style="display: none;">
            <h3>‚öô Conversion Settings</h3>
            <div class="format-options">
                <div class="format-option">
                    <input type="radio" id="formatJPG" name="format" value="jpg" checked>
                    <label for="formatJPG">JPG Format</label>
                </div>
                <div class="format-option">
                    <input type="radio" id="formatPNG" name="format" value="png">
                    <label for="formatPNG">PNG Format</label>
                </div>
            </div>
            <div style="margin: 15px 0;">
                <label>Image Quality: </label>
                <input type="range" id="quality" min="0.5" max="1" step="0.1" value="0.8">
                <span id="qualityValue">80%</span>
            </div>
            <div style="margin: 15px 0;">
                <label>Scale: </label>
                <input type="range" id="scale" min="1" max="3" step="0.5" value="2">
                <span id="scaleValue">2x</span>
            </div>
        </div>

        <!-- Page Preview Section -->
        <div class="page-preview" id="pagePreview" style="display: none;">
            <h3>üìÑ Select Pages to Convert</h3>
            <div style="text-align: center; margin: 15px 0;">
                <button class="btn" onclick="selectAllPages()">Select All</button>
                <button class="btn btn-secondary" onclick="deselectAllPages()">Deselect All</button>
            </div>
            
            <div class="page-thumbnails" id="pageThumbnails">
                <!-- Page thumbnails will be generated here -->
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="conversionProgress"></div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" id="convertBtn" onclick="convertToImages()" disabled>
                    üñº Convert Selected Pages
                </button>
                <button class="btn btn-secondary" onclick="resetConverter()">
                    üîÑ Reset
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="result" style="text-align: center; margin-top: 20px;"></div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p id="loadingText">Processing your PDF... This may take a few moments</p>
        </div>

        <!-- Navigation -->
        <div style="text-align: center; margin-top: 30px;">
            <a href="index.html" class="back-btn">‚Üê Back to All Tools</a>
        </div>
    </div>

    <script>
        // Set up PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        let currentPDF = null;
        let totalPages = 0;
        let selectedPages = new Set();

        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        document.getElementById('quality').addEventListener('input', function() {
            document.getElementById('qualityValue').textContent = Math.round(this.value * 100) + '%';
        });
        document.getElementById('scale').addEventListener('input', function() {
            document.getElementById('scaleValue').textContent = this.value + 'x';
        });
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                loadPDF(file);
            } else {
                alert('Please select a valid PDF file.');
            }
        }

        async function loadPDF(file) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Loading PDF...';
            document.getElementById('pagePreview').style.display = 'none';
            document.getElementById('qualityOptions').style.display = 'none';
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                currentPDF = await pdfjsLib.getDocument(arrayBuffer).promise;
                totalPages = currentPDF.numPages;
                
                await generatePageThumbnails();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('pagePreview').style.display = 'block';
                document.getElementById('qualityOptions').style.display = 'block';
                updateConvertButton();
                
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                alert('Error loading PDF: ' + error.message);
            }
        }

        async function generatePageThumbnails() {
            const thumbnailsContainer = document.getElementById('pageThumbnails');
            thumbnailsContainer.innerHTML = '';
            selectedPages.clear();

            for (let i = 1; i <= totalPages; i++) {
                const page = await currentPDF.getPage(i);
                const viewport = page.getViewport({ scale: 0.15 });
                
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                
                await page.render({
                    canvasContext: context,
                    viewport: viewport
                }).promise;

                const thumbContainer = document.createElement('div');
                thumbContainer.className = 'page-thumb';
                thumbContainer.innerHTML = `
                    <img src="${canvas.toDataURL()}" style="width: 100%; height: 100%; object-fit: cover;">
                    <div class="page-number">${i}</div>
                    <input type="checkbox" class="page-checkbox" checked onchange="togglePageSelection(${i}, this)">
                `;
                
                thumbnailsContainer.appendChild(thumbContainer);
                selectedPages.add(i);
            }
            
            updateThumbnailSelection();
        }

        function togglePageSelection(pageNum, checkbox) {
            if (checkbox.checked) {
                selectedPages.add(pageNum);
            } else {
                selectedPages.delete(pageNum);
            }
            updateThumbnailSelection();
            updateConvertButton();
        }

        function selectAllPages() {
            selectedPages.clear();
            const checkboxes = document.querySelectorAll('.page-checkbox');
            checkboxes.forEach((checkbox, index) => {
                checkbox.checked = true;
                selectedPages.add(index + 1);
            });
            updateThumbnailSelection();
            updateConvertButton();
        }

        function deselectAllPages() {
            selectedPages.clear();
            const checkboxes = document.querySelectorAll('.page-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateThumbnailSelection();
            updateConvertButton();
        }

        function updateThumbnailSelection() {
            const thumbs = document.querySelectorAll('.page-thumb');
            thumbs.forEach((thumb, index) => {
                const pageNum = index + 1;
                if (selectedPages.has(pageNum)) {
                    thumb.classList.add('selected');
                } else {
                    thumb.classList.remove('selected');
                }
            });
        }

        function updateConvertButton() {
            const convertBtn = document.getElementById('convertBtn');
            convertBtn.disabled = selectedPages.size === 0;
        }

        async function convertToImages() {
            if (selectedPages.size === 0) {
                alert('Please select at least one page to convert.');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').innerHTML = '';
            document.getElementById('conversionProgress').style.width = '0%';

            try {
                const format = document.querySelector('input[name="format"]:checked').value;
                const quality = parseFloat(document.getElementById('quality').value);
                const scale = parseFloat(document.getElementById('scale').value);
                
                const pagesToConvert = Array.from(selectedPages).sort((a, b) => a - b);
                const totalToConvert = pagesToConvert.length;
                let convertedCount = 0;

                // Create ZIP for multiple images
                const zip = new JSZip();
                
                for (const pageNum of pagesToConvert) {
                    document.getElementById('loadingText').textContent = Converting page ${pageNum} of ${totalPages}...;
                    
                    const imageData = await convertPageToImage(pageNum, format, quality, scale);
                    const fileName = page-${pageNum}.${format};
                    
                    // Convert base64 to blob and add to zip
                    const blob = base64ToBlob(imageData, image/${format});
                    zip.file(fileName, blob);
                    
                    convertedCount++;
                    const progress = (convertedCount / totalToConvert) * 100;
                    document.getElementById('conversionProgress').style.width = progress + '%';
                }

                // Generate and download ZIP
                const zipBlob = await zip.generateAsync({type: 'blob'});
                saveAs(zipBlob, 'converted-images.zip');
                
                document.getElementById('result').innerHTML = `
                    <div style="color: #28a745; background: #d4edda; padding: 15px; border-radius: 5px;">
                        ‚úÖ Successfully converted ${convertedCount} pages to ${format.toUpperCase()}! 
                        Downloading ZIP file...
                    </div>
                `;

            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <div style="color: #dc3545; background: #f8d7da; padding: 15px; border-radius: 5px;">
                        ‚ùå Error converting PDF: ${error.message}
                    </div>
                `;
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('conversionProgress').style.width = '0%';
            }
        }

        async function convertPageToImage(pageNum, format, quality, scale) {
            const page = await currentPDF.getPage(pageNum);
            const viewport = page.getViewport({ scale: scale });
            
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            
            await page.render({
                canvasContext: context,
                viewport: viewport
            }).promise;

            return canvas.toDataURL(image/${format}, quality);
        }

        function base64ToBlob(base64, mimeType) {
            const byteCharacters = atob(base64.split(',')[1]);
            const byteArrays = [];
            
            for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                const slice = byteCharacters.slice(offset, offset + 512);
                const byteNumbers = new Array(slice.length);
                
                for (let i = 0; i < slice.length; i++) {
                    byteNumbers[i] = slice.charCodeAt(i);
                }
                
                const byteArray = new Uint8Array(byteNumbers);
                byteArrays.push(byteArray);
            }
            
            return new Blob(byteArrays, { type: mimeType });
        }

        function resetConverter() {
            currentPDF = null;
            totalPages = 0;
            selectedPages.clear();
            document.getElementById('fileInput').value = '';
            document.getElementById('pagePreview').style.display = 'none';
            document.getElementById('qualityOptions').style.display = 'none';
            document.getElementById('result').innerHTML = '';
            document.getElementById('conversionProgress').style.width = '0%';
        }

        // Drag and drop functionality
        const dropArea = document.getElementById('dropArea');
        ['dragover', 'dragenter'].forEach(event => {
            dropArea.addEventListener(event, (e) => {
                e.preventDefault();
                dropArea.style.background = '#f0f4ff';
                dropArea.style.borderColor = '#667eea';
            });
        });

        ['dragleave', 'dragend'].forEach(event => {
            dropArea.addEventListener(event, (e) => {
                e.preventDefault();
                dropArea.style.background = '';
                dropArea.style.borderColor = '#667eea';
            });
        });

        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.background = '';
            dropArea.style.borderColor = '#667eea';
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                loadPDF(file);
            } else {
                alert('Please drop a valid PDF file.');
            }
        });
    </script>
</body>
</html>
